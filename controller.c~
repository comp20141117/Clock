#include "global.h"
#include "controller.h"
#include "model.h"
#include "view.h"
#include <stdio.h>

int key_a = 0;
int key_b = 0;

int divider=0;

static int flag=0;

void timer_to_title();
int A();
int B();
void timer();
void digit_time();
void digit_date();
void title_to_time();
void title_to_date();
void flash();

void timer_to_title()
{
  switch(flag)
    {
    case 2:
      if(digit3 == ' ')
	minute=digit4;
      else
	minute=digit4 + digit3 * 10;
      break;
    case 3:
      if(digit1 == ' ')
	hour=digit2;
      else
        hour=digit2 + digit1 *10;
      break;
    case 4:
      if(digit3 == ' ')
	day=digit4;
      else
	day=digit4 +digit3 *10;
      break;
    case 0:
      if(digit1 == ' ')
	month=digit2;
      else
        month= digit2 + digit1 *10;
      break;
    case 1:
      break;
    }
}

void flash()
{
  if(divider%10==0)
    colon=!colon;
}

int A()
{
  static int prev_key_a=0;
  int temp=0;
  if(prev_key_a ==0 && key_a ==1)
    {
      temp=1;
    }
  prev_key_a=key_a;
  return temp;
}

int B()
{
   static int prev_key_b = 0;
   int temp=0;
    if(prev_key_b == 0 && key_b == 1)
    {
      temp=1;
    }
    prev_key_b = key_b;
    return temp;
}

void timer()
{
  if(second>=60)
    {
      second=0;
      minute++;
    }
  if(minute>=60)
    {
      minute=0;
      hour++;
    }
  if(hour>=24)
    {
      hour=0;
      day++;
    }
  if(day>month_num_days[month])
    {
      day=1;
      month++;
    }
  if(month>12)
    month=1;
}

void digit_time()
{
  if(digit4 >9)
    {
      digit4 = 0;
      digit3 ++;
    }
  if(digit3 >=6)
    {
      digit3 = 0;
      digit2 ++;
    }
  if(digit2 >9 && digit1 <2)
    {
      digit2=0;
      digit1++;
    }
  if(digit2 >4 && digit1 == 2)
    {
      digit2=0;
      digit1=0;
    }
}

void digit_date()
{
  int x,y;
  x=(month_num_days[month])/10;
  y=(month_num_days[month])%10;
  if(digit4 >9 && digit3 <x)
    {
      digit4=1;
      digit3++;
    }
  if(digit3 == x && digit4 >y)
    {
      digit2++;
      digit4=1;
      digit3=0;
    }
  if(digit2 >9 && digit1 ==0)
    {
      digit2=0;
      digit1++;
    }
  if( digit1 ==1 && digit2 >2)
    {
      digit2=1;
      digit1=0;
    }
  if(digit3 ==0)
    digit3 =' ';
  if(digit1 ==0)
    digit1 =' ';
}

void title_to_time()
{
  digit4 =minute%10;
  digit3 =minute/10;
  digit2 =hour%10;
  digit1 =hour/10;
}

void title_to_date()
{
  digit4 =day%10;
  digit3 =day/10;
  digit2 =month%10;
  digit1 =month/10;
}

void timer_go()
{
  if(++divider==20)
    {
      divider=0;
      second++;
      timer();
    }
}

void timer_int()
{
  timer_go();
  if(A())
    {
      flag++;
      if(flag>4)
	flag=0;
	timer_to_title();
    }
  if(B())
    {
       switch(flag)
	{
	  /*case 0:
	    title_to_date();
	    colon=0;
	    digit_date();
	    break;
	  case 1:
	    title_to_time();
	    flash();
	    digit4 ++;
	    digit_time();
	    break;
	  case 2:
	    title_to_time();
	    flash();
	    digit2 ++;
	    digit_time();
	    break;
	  case 3:
	    title_to_date();
	    flash();
	    digit4 ++;
	    digit_date();
	    break;
	  case 4:
	    title_to_date();
	    flash();
	    digit2 ++;
	    digit_date();
	    break;
	  default:
	  break;
	  */      
	  }
    }
}



